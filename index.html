<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Fractured Realm Rulebook</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#5e5754">
<style>
  html, body {
    margin:0; padding:0;
    height:100%; width:100%;
    background-color:#5e5754;
    display:flex; justify-content:center; align-items:center;
    overflow:hidden;
    font-family:Verdana,Arial,sans-serif;
  }

  .stage {
    width:90%; height:90%;
    perspective:1600px;
    display:flex; align-items:center; justify-content:center;
    position:relative;
  }

  .book {
    width:100%; height:100%; position:relative;
  }

  .page {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background:#5e5754;
    border-radius:10px;
    box-shadow:0 12px 30px rgba(0,0,0,0.25);
    overflow:hidden;
    display:flex; justify-content:center; align-items:center;
    -webkit-backface-visibility:hidden;
    backface-visibility:hidden;
    transform-origin:left center;
    transition: transform 700ms cubic-bezier(.2,.9,.25,1), box-shadow 300ms;
  }

  .page img {
    max-width:95%;
    max-height:95%;
    object-fit:contain;
  }

  .page.visible { transform: none; }
  .page.flip-forward { transform: rotateY(-180deg); box-shadow:0 18px 36px rgba(0,0,0,0.35); }
  .page.incoming { transform: rotateY(180deg); }
  .page.incoming.show { transform: rotateY(0deg); }

  @supports not (transform-style: preserve-3d) {
    .page.flip-forward { transform: translateX(-100%); transition: transform 320ms ease; }
    .page.incoming { transform: translateX(100%); }
    .page.incoming.show { transform: translateX(0); }
  }

  .controls {
    position:absolute;
    top:50%; width:100%;
    display:flex; justify-content:space-between;
    transform:translateY(-50%);
    padding:0 10px;
    pointer-events:none;
  }

  .btn {
    background: rgba(43,121,146,0.8);
    color:white;
    border:none;
    padding:10px 15px;
    font-size:1.5rem;
    border-radius:8px;
    cursor:pointer;
    pointer-events:auto;
    user-select:none;
  }
  .btn:active { transform: translateY(1px); }
</style>
</head>
<body>
  <div class="stage" id="stage">
    <div class="book" id="book"></div>

    <div class="controls">
      <button class="btn" id="prevBtn">⟵</button>
      <button class="btn" id="nextBtn">⟶</button>
    </div>
  </div>

<script>
const pages = [
  "CARD_GAME–Rule_Set-01.png",
  "CARD_GAME–Rule_Set-02.png",
  "CARD_GAME–Rule_Set-03.png",
  "CARD_GAME–Rule_Set-04.png",
  "CARD_GAME–Rule_Set-05.png",
  "CARD_GAME–Rule_Set-06.png",
  "CARD_GAME–Rule_Set-07.png",
  "CARD_GAME–Rule_Set-08.png",
  "CARD_GAME–Rule_Set-09.png",
  "CARD_GAME–Rule_Set-10.png",
  "CARD_GAME–Rule_Set-11.png",
  "CARD_GAME–Rule_Set-12.png",
  "CARD_GAME–Rule_Set-13.png",
  "CARD_GAME–Rule_Set-14.png",
  "CARD_GAME–Rule_Set-15.png",
  "CARD_GAME–Rule_Set-16.png",
  "CARD_GAME–Rule_Set-17.png",
  "fracturedrealmlogo.png"  // last page is logo
];

let currentIndex = 0;
const bookEl = document.getElementById('book');
let pageEls = [];

// create page elements
function createPage(baseName, index){
  const page = document.createElement('div');
  page.className = 'page incoming';
  page.dataset.index = index;

  const img = document.createElement('img');
  img.src = encodeURIComponent(baseName);
  img.onerror = ()=>{ img.remove(); };
  page.appendChild(img);

  return page;
}

// build all pages
function buildPages(){
  bookEl.innerHTML = '';
  pages.forEach((p,i)=>{
    const el = createPage(p,i);
    bookEl.appendChild(el);
  });
  pageEls = Array.from(bookEl.querySelectorAll('.page'));
  pageEls[currentIndex].classList.add('visible'); // show page 1 on load
}

function nextPage(){
  if(currentIndex >= pageEls.length-1) return;
  const curr = pageEls[currentIndex];
  const next = pageEls[currentIndex+1];
  next.classList.add('incoming');
  void next.offsetWidth; // force reflow
  curr.classList.add('flip-forward');
  next.classList.add('show');
  setTimeout(()=>{
    curr.classList.remove('visible','flip-forward');
    next.classList.remove('incoming','show');
    currentIndex++;
    pageEls[currentIndex].classList.add('visible');
  },720);
}

function prevPage(){
  if(currentIndex <= 0) return;
  const curr = pageEls[currentIndex];
  const prev = pageEls[currentIndex-1];
  prev.classList.add('incoming');
  prev.style.transform = 'rotateY(-180deg)';
  void prev.offsetWidth;
  prev.classList.add('show');
  curr.classList.add('flip-forward');
  setTimeout(()=>{
    prev.classList.remove('incoming','show');
    prev.style.transform='';
    curr.classList.remove('visible','flip-forward');
    currentIndex--;
    pageEls[currentIndex].classList.add('visible');
  },720);
}

// swipe handling
let startX=0,startY=0,startTime=0;
const threshold=40,allowedTime=500;
document.getElementById('stage').addEventListener('touchstart',e=>{
  const t = e.changedTouches[0];
  startX = t.pageX; startY = t.pageY; startTime = Date.now();
},{passive:true});
document.getElementById('stage').addEventListener('touchend',e=>{
  const t = e.changedTouches[0];
  const dx = t.pageX-startX, dy = t.pageY-startY, dt = Date.now()-startTime;
  if(dt<=allowedTime && Math.abs(dx)>=threshold && Math.abs(dy)<=120){
    if(dx<0) nextPage();
    else prevPage();
  }
},{passive:true});

// buttons
document.getElementById('nextBtn').addEventListener('click', nextPage);
document.getElementById('prevBtn').addEventListener('click', prevPage);

// keyboard support
window.addEventListener('keydown', e=>{
  if(e.key==='ArrowRight') nextPage();
  if(e.key==='ArrowLeft') prevPage();
});

buildPages();

// register service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(err=>console.warn('SW failed:',err));
}
</script>
</body>
</html>
